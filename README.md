# Energy Consumption Prediction

ГПО "Белэнерго", Управление электрических режимов. 2023 год (май - июль).

Инженер Бруцкий-Стемпковский Николай Александрович

Проект по прогнозирования потребления электрической энергии в ОЭС Беларуси на сутки вперед для целей оперативного планирования.

## Preprocessing

На данном этапе были собраны и очещены исхожные данные для проекта, которые представляют собой среднечасовые значения температуры наружного воздуха (ТНВ) и потребления электрической энергии в ОЭС. Для очистки предложена функция catch_time_series_outs, позволяющая определять нехарактерные кратковременные изменения исходного временного ряда.

## EDA

На данном этапе исходные данные были исследованы на наличие частотных компонент. Потребление электроэнергии имеет высокую периодичность по суточной, недельной и годовой частотам, ТНВ - суточной и годовой. При избавлении от сезонности в потреблении энергии, временной ряд показывает высокую стационарность. Наблюдается наличие тренда (постоянной составляющей) величиной до 5500 МВт. Периодическая составляющая имеет размаз порядка 1000 МВт.

## Training

На данном этапе для предсказания были выбраны 5 моделей различного характера. Они все так или иначе требоваля данных для тернировки. Однако их проверка выполнялась на данных, собранных за последние полгода (2022-12-01 - 2023-05-31). Все модели сделали предсказания на 182 суточные точки. Метрикой сравнения, как наиболее пригодной для сравнения выбрана средняя абсолютная ошибка (MAE).

### BaseLineModel (наивное решение)

Наивное решение использует тот факт, что данные имеют высокую периодичность по неделям (в том числе). Для предсказания почасового потребления на следующие сутки используется значение с прошлой недели. Данное решение показало ошибку в 148.5 МВт.

### ARIMA

Для предсказания данных, значения потребления были приведены через вычитание прошлонедельных значений. Модель с базовыми настройками (p, d, q = 0, 0, 0) дала MAE в районе 132 МВт. При подборе параметров через грид-сёрч (p, d, q = 14, 0, 0) снизил до 127.7 МВт. Модель затратна по времени.

### Prophet

Полученный результат при работе из коробки плохой. Модель требовательна по времени. Ошибка составила 226.7 МВт.

### Light Gradient Boosting Machine (LightGBM)

Для данной модели (моделей) данные были подготовлены в виде векторов, которые содержат:

- История потребления и ТНВ за прошлую неделю;
- Эти же сведения за соответсвующую дату в прошлом году;
- Закодированные сведения о времени суток, дне недели, месяце и дне года в формате тригонометрических функций;
- Сведения о том, рабочий ли это день или выходной (как грядущий, так и соответсвующий ему прошлогодний);

Для предсказания были натренированы 24 модели, каждая из которых делает предсказание на соответствующий час суток. Модель показала МАЕ в  77.1 МВт.

### RNN

Для предсказания были натренированы модели рекуррентных нейронных сетей из слоев сверток, пуллинга, рекуррентных слоёв SimpleRNN и полносвязныз слоев. Лучшая модель имела архитектуру из 2-х сверточных 2-х пуллинговых слоев, одного слоя SimpleRNN и 3-х полносвязных слоев, всего 21_592 тренируемых параметров. Наилуший результат составил 97.4 МВт.

### RNN with two inputs

Попытка объединить лучшие свойства RNN и feature extracting, который был использован для LightGBM. Это нейронная сеть с двумя входами. Рекуррентная часть содержит два блока из конволюции, свёртки и SimpleRNN, полносвязная часть содержит три полносвяхных слоя. Общая решающая часть имеет два слоя (вместе с выходным). MAE составляет 85.2 МВт.

### Ensemble

Ансамбль из решений LGBM и RNN with two inputs. Простое усреднение ответов. MAE составляет 68.6 МВт.

## Deployment

На данном этапе выполнено:

- создана БД (sqlite) c тремя таблицами (consumption_table, day_off_table, predict_table). Первая хранит очищенные данные из ОИК о фактических потреблении и температуре в часовой резолюции. Вторая хранит календарь  суточной резолюции. Третья - результаты работы моделей в формате Tide-table. Наполнение БД происходит в момент вызова main-file. Наполнение присоходит до "полного" полудня, который доступен к данному моменту;
- main-file предоставляет возможность сделать прогноз на определенный день. При этом выполняется проверка наличия всех необходимых исходных данных. Если в порядке, поднимаются достуные модели (LightGBM & RNN with two inputs), которые возвращают прогнозы. Их прогнозы, а также прогноз ансамбля записывается в БД. Также формируется отчёт в виде .jpg и .xlsx файлов.
- по плану при первом запуске впервые в месяце происходит обращение к БД, откуда выкачиваются все предикты и фактические значения за прошлый календарный месяц. По прогнозным и фактическим значениям мониторится качество модели, формируется отчет в виде .jpg и .txt файлов;
